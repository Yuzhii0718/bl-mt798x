function ajax(t) { var e; (e = window.XMLHttpRequest ? new XMLHttpRequest : new ActiveXObject("Microsoft.XMLHTTP")).upload.addEventListener("progress", (function (e) { t.progress && t.progress(e) })), e.onreadystatechange = function () { 4 == e.readyState && 200 == e.status && t.done && t.done(e.responseText) }, t.timeout && (e.timeout = t.timeout); var n = "GET"; t.data && (n = "POST"), e.open(n, t.url), e.send(t.data) } const I18N_DICTIONARY = { en: { common: { app: "Failsafe-WebUI", nav: { home: "Firmware Update", uboot: "U-Boot Update", bl2: "BL2 Update", gpt: "GPT Partition", initramfs: "Initramfs" }, sections: { enhancements: "Enhancements" }, actions: { upload: "Upload", update: "Update" }, author: "ğŸ’¡ Yuzhii", dialog: { yes: "Yes", no: "No" }, targets: { firmware: "firmware image", uboot: "U-Boot image", bl2: "BL2 image", gpt: "GPT", initramfs: "initramfs image" }, hints: { update: "You are going to update <strong>{target}</strong> on the device.<br>Please, choose file from your local hard drive and click <strong>Upload</strong> button.", load: "You are going to load <strong>{target}</strong> on the device.<br>Please, choose file from your local hard drive and click <strong>Upload</strong> button." }, warns: { no_power_off: "do not power off the device during update", will_restart: "if everything goes well, the device will restart", ensure_proper_target: "you can upload whatever you want, so be sure that you choose proper {target} for your device", boot_into_target: "if everything goes well, the device will boot into the {target}" }, labels: { current_mtd_layout: "Current mtd layout:", choose_mtd_layout: "Choose mtd layout:", size: "Size:", md5: "MD5:", mtd_layout: "MTD layout:" }, warnings: { heading: "WARNINGS" }, upgradePrompt: 'If all information above is correct, click "Update".' }, index: { title: "FIRMWARE UPDATE" }, uboot: { title: "U-BOOT UPDATE", warn4: "updating U-Boot is a very dangerous operation and may damage your device!" }, bl2: { title: "BL2 UPDATE", warn4: "updating BL2 is a very dangerous operation and may damage your device!" }, gpt: { title: "GPT UPDATE", warn4: "updating GPT is a dangerous operation and may damage your device!" }, gptConfirm: { title: "GPT Update Confirmation", prompt: "Is your device an MMC device? Only MMC devices should update GPT. <strong>Updating GPT on nonâ€‘MMC devices will damage the device.</strong>", nonMmcTitle: "Unsupported Device", nonMmcMessage: "Updating GPT on nonâ€‘MMC devices may damage the device. Redirecting to home in {s}s..." }, initramfs: { title: "LOAD INITRAMFS", upgradePrompt: 'If all information above is correct, click "Boot".', actionBoot: "Boot" }, flashing: { titleInProgress: "UPDATE IN PROGRESS", infoInProgress: "Your file was successfully uploaded! Update is in progress and you should wait for automatic reset of the device.<br>Update time depends on image size and may take up to a few minutes.", titleDone: "UPDATE COMPLETED", infoDone: "Your device was successfully updated! Now rebooting..." }, booting: { titleInProgress: "BOOTING INITRAMFS", infoInProgress: "Your file was successfully uploaded! Booting is in progress, please wait...<br>This page may be in not responding status for a short time.", titleDone: "BOOT SUCCESS", infoDone: "Your device was successfully booted into initramfs!" }, fail: { title: "UPDATE FAILED", message: "<strong>Something went wrong during update</strong>Probably you have chosen wrong file. Please, try again or contact with the author of this modification. You can also get more information during update in U-Boot console." } }, "zh-CN": { common: { app: "æ¢å¤æ¨¡å¼-WebUI", nav: { home: "å›ºä»¶æ›´æ–°", uboot: "U-Boot æ›´æ–°", bl2: "BL2 æ›´æ–°", gpt: "GPT åˆ†åŒº", initramfs: "Initramfs" }, sections: { enhancements: "å¢å¼ºåŠŸèƒ½" }, actions: { upload: "ä¸Šä¼ ", update: "æ›´æ–°" }, author: "ğŸ’¡ Yuzhii", dialog: { yes: "æ˜¯", no: "å¦" }, targets: { firmware: "å›ºä»¶", uboot: "U-Boot é•œåƒ", bl2: "BL2 é•œåƒ", gpt: "GPT æ–‡ä»¶", initramfs: "initramfs é•œåƒ" }, hints: { update: "æ‚¨å°†è¦æ›´æ–°è®¾å¤‡çš„ <strong>{target}</strong>ã€‚<br>è¯·ä»æœ¬åœ°ç¡¬ç›˜é€‰æ‹©æ–‡ä»¶å¹¶ç‚¹å‡»<strong>ä¸Šä¼ </strong>æŒ‰é’®ã€‚", load: "æ‚¨å°†è¦å‘è®¾å¤‡åŠ è½½ <strong>{target}</strong>ã€‚<br>è¯·ä»æœ¬åœ°ç¡¬ç›˜é€‰æ‹©æ–‡ä»¶å¹¶ç‚¹å‡»<strong>ä¸Šä¼ </strong>æŒ‰é’®ã€‚" }, warns: { no_power_off: "æ›´æ–°è¿‡ç¨‹ä¸­è¯·å‹¿æ–­ç”µ", will_restart: "å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œè®¾å¤‡å°†ä¼šé‡å¯", ensure_proper_target: "æ‚¨å¯ä»¥ä¸Šä¼ ä»»æ„æ–‡ä»¶ï¼Œè¯·ç¡®ä¿é€‰æ‹©äº†é€‚ç”¨äºè®¾å¤‡çš„ {target}", boot_into_target: "å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œè®¾å¤‡å°†å¼•å¯¼è¿›å…¥ {target}" }, labels: { current_mtd_layout: "å½“å‰åˆ†åŒºå¸ƒå±€:", choose_mtd_layout: "é€‰æ‹©åˆ†åŒºå¸ƒå±€:", size: "å¤§å°:", md5: "MD5:", mtd_layout: "åˆ†åŒºå¸ƒå±€:" }, warnings: { heading: "è­¦å‘Š" }, upgradePrompt: "å¦‚æœä»¥ä¸Šä¿¡æ¯æ­£ç¡®ï¼Œè¯·ç‚¹å‡»â€œæ›´æ–°â€ã€‚" }, index: { title: "å›ºä»¶æ›´æ–°" }, uboot: { title: "U-Boot æ›´æ–°", warn4: "æ›´æ–° U-Boot é£é™©æé«˜ï¼Œå¯èƒ½å¯¼è‡´è®¾å¤‡æŸåï¼" }, flashing: { titleInProgress: "æ­£åœ¨æ›´æ–°", infoInProgress: "æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼æ›´æ–°æ­£åœ¨è¿›è¡Œï¼Œè¯·ç­‰å¾…è®¾å¤‡è‡ªåŠ¨é‡å¯ã€‚<br>æ›´æ–°æ—¶é—´å–å†³äºé•œåƒå¤§å°ï¼Œå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿã€‚", titleDone: "æ›´æ–°å®Œæˆ", infoDone: "è®¾å¤‡å·²æˆåŠŸæ›´æ–°ï¼æ­£åœ¨é‡å¯â€¦â€¦" }, booting: { titleInProgress: "æ­£åœ¨å¼•å¯¼ Initramfs", infoInProgress: "æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼æ­£åœ¨å¼•å¯¼ï¼Œè¯·ç¨å€™â€¦â€¦<br>æ­¤é¡µé¢çŸ­æ—¶é—´å¯èƒ½æ— å“åº”å±æ­£å¸¸æƒ…å†µã€‚", titleDone: "å¼•å¯¼æˆåŠŸ", infoDone: "è®¾å¤‡å·²æˆåŠŸå¼•å¯¼è¿›å…¥ initramfsï¼" }, fail: { title: "æ›´æ–°å¤±è´¥", message: "<strong>æ›´æ–°è¿‡ç¨‹ä¸­å‡ºç°é—®é¢˜</strong>å¯èƒ½é€‰æ‹©äº†é”™è¯¯çš„æ–‡ä»¶ã€‚è¯·é‡è¯•æˆ–è”ç³»è¯¥ä¿®æ”¹çš„ä½œè€…ã€‚ä¹Ÿå¯åœ¨ U-Boot æ§åˆ¶å°æŸ¥çœ‹æ›´å¤šä¿¡æ¯ã€‚" }, bl2: { title: "BL2 æ›´æ–°", warn4: "æ›´æ–° BL2 é£é™©æé«˜ï¼Œå¯èƒ½å¯¼è‡´è®¾å¤‡æŸåï¼" }, gpt: { title: "GPT æ›´æ–°", warn4: "æ›´æ–° GPT å…·æœ‰ä¸€å®šé£é™©ï¼Œå¯èƒ½å¯¼è‡´è®¾å¤‡æŸåï¼" }, gptConfirm: { title: "GPT æ›´æ–°ç¡®è®¤", prompt: "ä½ çš„è®¾å¤‡æ˜¯ MMC è®¾å¤‡å—ï¼Ÿä»… MMC è®¾å¤‡å¯æ›´æ–° GPTã€‚<strong>é MMC è®¾å¤‡æ›´æ–°å¯èƒ½å¯¼è‡´è®¾å¤‡æŸåã€‚</strong>", nonMmcTitle: "è®¾å¤‡ä¸å—æ”¯æŒ", nonMmcMessage: "é MMC è®¾å¤‡æ›´æ–° GPT å¯èƒ½å¯¼è‡´è®¾å¤‡æŸåã€‚{s} ç§’åè¿”å›é¦–é¡µâ€¦â€¦" }, initramfs: { title: "åŠ è½½ Initramfs", upgradePrompt: "å¦‚æœä»¥ä¸Šä¿¡æ¯æ­£ç¡®ï¼Œè¯·ç‚¹å‡»â€œå¯åŠ¨â€ã€‚", actionBoot: "å¯åŠ¨" } } }; function tt(e, n) { const o = t(e); return "string" != typeof o ? o : n ? o.replace(/\{(\w+)\}/g, ((t, e) => null != n[e] ? n[e] : "{" + e + "}")) : o } function resolveParams(e) { if (!e) return {}; const n = {}; return Object.keys(e).forEach((o => { const a = e[o]; a && "object" == typeof a && a.t ? n[o] = t(a.t) : n[o] = a })), n } function detectLanguage() { const t = localStorage.getItem("lang"); if (t && "auto" !== t) return t; return ((navigator.languages || [navigator.language || "en"])[0] || "en").toLowerCase().startsWith("zh") ? "zh-CN" : "en" } function t(t) { const e = detectLanguage(), n = t.split("."); let o = I18N_DICTIONARY[e]; for (const e of n) { if (!o || "object" != typeof o) return t; o = o[e] } return "string" == typeof o ? o : t } function applyPageTranslations() { const e = (location.pathname || "").toLowerCase(), n = getPageIdFromPath(); if (window.__skipTemplateTranslation) return; const o = document.querySelector('input[type="button"][value]'); o && (o.value = t("common.actions.upload")); const a = document.querySelector("#upgrade .button"), i = document.querySelector("#upgrade p"); e.endsWith("/initramfs.html") ? (a && (a.textContent = t("initramfs.actionBoot")), i && (i.innerHTML = t("initramfs.upgradePrompt"))) : (a && (a.textContent = t("common.actions.update")), i && (i.innerHTML = t("common.upgradePrompt"))); const r = document.getElementById("current_mtd_layout"); r && r.textContent; const s = document.querySelector(".i.w strong"); if (s && (s.textContent = t("common.warnings.heading")), n && PAGE_TEMPLATES[n]) { const e = PAGE_TEMPLATES[n], o = document.querySelector("h1"); o && e.keys && e.keys.title && (o.textContent = t(e.keys.title)); const a = document.getElementById("hint"); if (a) { const n = e.hintTpl ? tt(e.hintTpl, resolveParams(e.hintParams)) : e.keys && e.keys.hint ? t(e.keys.hint) : ""; a.innerHTML = n } const i = document.querySelector(".i.w ul"); if (i && e.warnings) { const n = e.warnings.map((e => "string" == typeof e ? "<li>" + t(e) + "</li>" : "<li>" + tt(e.key, resolveParams(e.params)) + "</li>")).join(""); i.innerHTML = n } } else if (e.endsWith("/flashing.html")) { const e = document.getElementById("title") || document.querySelector("h1"); e && (e.textContent = t("flashing.titleInProgress")); const n = document.getElementById("info"); n && (n.innerHTML = t("flashing.infoInProgress")) } else if (e.endsWith("/booting.html")) { const e = document.getElementById("title") || document.querySelector("h1"); e && (e.textContent = t("booting.titleInProgress")); const n = document.getElementById("info"); n && (n.innerHTML = t("booting.infoInProgress")) } else if (e.endsWith("/fail.html")) { const e = document.querySelector("h1"); e && (e.textContent = t("fail.title")); const n = document.querySelector(".i.e"); n && (n.innerHTML = t("fail.message")) } } function detectTheme() { const t = localStorage.getItem("theme"); return t && "auto" !== t ? t : window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light" } function applyTheme(t) { document.documentElement.setAttribute("data-theme", t) } function initThemeWatcher() { const t = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)"); t && t.addEventListener("change", (() => { const t = localStorage.getItem("theme"); t && "auto" !== t || applyTheme(detectTheme()) })) } const PAGE_TEMPLATES = { index: { fileField: "firmware", action: { type: "update", href: "/flashing.html" }, showMtd: !0, keys: { title: "index.title" }, hintTpl: "common.hints.update", hintParams: { target: { t: "common.targets.firmware" } }, warnings: [{ key: "common.warns.no_power_off" }, { key: "common.warns.will_restart" }, { key: "common.warns.ensure_proper_target", params: { target: { t: "common.targets.firmware" } } }] }, uboot: { fileField: "fip", action: { type: "update", href: "/flashing.html" }, showMtd: !1, keys: { title: "uboot.title" }, hintTpl: "common.hints.update", hintParams: { target: { t: "common.targets.uboot" } }, warnings: [{ key: "common.warns.no_power_off" }, { key: "common.warns.will_restart" }, { key: "common.warns.ensure_proper_target", params: { target: { t: "common.targets.uboot" } } }, { key: "uboot.warn4" }] }, bl2: { fileField: "bl2", action: { type: "update", href: "/flashing.html" }, showMtd: !1, keys: { title: "bl2.title" }, hintTpl: "common.hints.update", hintParams: { target: { t: "common.targets.bl2" } }, warnings: [{ key: "common.warns.no_power_off" }, { key: "common.warns.will_restart" }, { key: "common.warns.ensure_proper_target", params: { target: { t: "common.targets.bl2" } } }, { key: "bl2.warn4" }] }, gpt: { fileField: "gpt", action: { type: "update", href: "/flashing.html" }, showMtd: !1, keys: { title: "gpt.title" }, hintTpl: "common.hints.update", hintParams: { target: { t: "common.targets.gpt" } }, warnings: [{ key: "common.warns.no_power_off" }, { key: "common.warns.will_restart" }, { key: "common.warns.ensure_proper_target", params: { target: { t: "common.targets.gpt" } } }, { key: "gpt.warn4" }] }, initramfs: { fileField: "initramfs", action: { type: "boot", href: "/booting.html" }, showMtd: !1, keys: { title: "initramfs.title" }, hintTpl: "common.hints.load", hintParams: { target: { t: "common.targets.initramfs" } }, warnings: [{ key: "common.warns.boot_into_target", params: { target: { t: "common.targets.initramfs" } } }, { key: "common.warns.ensure_proper_target", params: { target: { t: "common.targets.initramfs" } } }] } }; function buildSpecialPageUI(e) { const n = document.getElementById("m"); n && ("flashing" === e ? n.innerHTML = ['<h1 id="title">' + t("flashing.titleInProgress") + "</h1>", '<p id="info">' + t("flashing.infoInProgress") + "</p>", '<div id="l"></div>'].join("") : "booting" === e ? n.innerHTML = ['<h1 id="title">' + t("booting.titleInProgress") + "</h1>", '<p id="info">' + t("booting.infoInProgress") + "</p>", '<div id="l"></div>'].join("") : "fail" === e && (n.innerHTML = ['<h1 class="red">' + t("fail.title") + "</h1>", '<div class="i e">' + t("fail.message") + "</div>"].join(""))) } function getPageIdFromPath() { const t = (location.pathname || "").toLowerCase(); return t.endsWith("/index.html") || "/" === t || t.endsWith("/") ? "index" : t.endsWith("/uboot.html") ? "uboot" : t.endsWith("/bl2.html") ? "bl2" : t.endsWith("/gpt.html") ? "gpt" : t.endsWith("/initramfs.html") ? "initramfs" : t.endsWith("/flashing.html") ? "flashing" : t.endsWith("/fail.html") ? "fail" : t.endsWith("/booting.html") ? "booting" : null } function buildTemplateUI(e) { const n = PAGE_TEMPLATES[e]; if (!n) return; const o = document.getElementById("m"); if (!o) return; const a = "boot" === n.action.type ? t("initramfs.actionBoot") : t("common.actions.update"), i = "boot" === n.action.type ? t("initramfs.upgradePrompt") : t("common.upgradePrompt"), r = n.warnings.map((e => { if ("string" == typeof e) return "<li>" + t(e) + "</li>"; return "<li>" + tt(e.key, resolveParams(e.params)) + "</li>" })).join(""), s = n.hintTpl ? tt(n.hintTpl, resolveParams(n.hintParams)) : n.keys && n.keys.hint ? t(n.keys.hint) : "", l = n.showMtd ? ['<div id="mtd_layout" style="display: none;">', '  <div id="current_mtd_layout"></div>', "<br>", "  " + t("common.labels.choose_mtd_layout") + "\t", '  <select id="mtd_layout_label" name="mtd_layout_label"></select>', "  <br><br>", "</div>"].join("") : ""; o.innerHTML = ["<h1>" + t(n.keys.title) + "</h1>", '<p id="hint">' + s + "</p>", '<form id="form">', l, '  <input id="file" type="file" name="' + n.fileField + '">', '  <input type="button" value="' + t("common.actions.upload") + '" onclick="upload(\'' + n.fileField + "')\">", "</form>", '<div><div class="bar" id="bar" style="display: none; --percent: 0;"></div></div>', '<div id="size" style="display: none;">' + t("common.labels.size") + " xxxx</div>", '<div id="md5" style="display: none;">' + t("common.labels.md5") + " xxxx</div>", n.showMtd ? '<div id="mtd" style="display: none;">' + t("common.labels.mtd_layout") + " xxxx</div>" : "", '<div id="upgrade" style="display: none;">', "  <p>" + i + "</p>", '  <button class="button" onclick="location = \'' + n.action.href + "'\">" + a + "</button>", "</div>", '<div class="i w">', "  <strong>" + t("common.warnings.heading") + "</strong>", "  <ul>" + r + "</ul>", "</div>"].join("") } function renderTemplateIfApplicable() { const t = getPageIdFromPath(); t && ("gpt" !== t ? PAGE_TEMPLATES[t] ? buildTemplateUI(t) : buildSpecialPageUI(t) : guardGptPageAsync()) } function guardGptPageAsync() { window.__skipTemplateTranslation = !0; showConfirmModal({ title: t("gptConfirm.title"), message: t("gptConfirm.prompt"), yesLabel: t("common.dialog.yes"), noLabel: t("common.dialog.no") }).then((e => { if (e) buildTemplateUI("gpt"), window.__skipTemplateTranslation = !1, applyPageTranslations(); else { const e = document.getElementById("m"); if (e) { const n = t("gptConfirm.nonMmcTitle"); let o = 3; const a = () => tt("gptConfirm.nonMmcMessage", { s: o }); e.innerHTML = ['<h1 class="red">' + n + "</h1>", '<div class="i e" id="gpt-nonmmc-msg">' + a() + "</div>"].join(""); const i = setInterval((() => { o -= 1; const t = document.getElementById("gpt-nonmmc-msg"); t && (t.innerHTML = a()), o <= 0 && (clearInterval(i), location.href = "/index.html") }), 1e3) } else location.href = "/index.html" } })).catch((() => { location.href = "/index.html" })) } function showConfirmModal({ title: t, message: e, yesLabel: n, noLabel: o }) { return new Promise((a => { const i = document.getElementById("app-modal"); i && i.remove(); const r = document.createElement("div"); r.id = "app-modal", r.className = "modal-overlay", r.setAttribute("role", "presentation"); const s = document.createElement("div"); s.className = "modal-dialog", s.setAttribute("role", "dialog"), s.setAttribute("aria-modal", "true"), s.setAttribute("aria-labelledby", "modal-title"), s.setAttribute("aria-describedby", "modal-desc"), s.innerHTML = ['<div class="modal-header" id="modal-title">' + t + "</div>", '<div class="modal-body" id="modal-desc">' + e + "</div>", '<div class="modal-actions">', '  <button class="btn secondary" id="modal-no">' + o + "</button>", '  <button class="btn primary" id="modal-yes">' + n + "</button>", "</div>"].join(""), r.appendChild(s), document.body.appendChild(r); const l = document.getElementById("modal-yes"), d = document.getElementById("modal-no"), m = t => { r.remove(), a(t) }; l.addEventListener("click", (() => m(!0))), d.addEventListener("click", (() => m(!1))), r.addEventListener("click", (t => { t.target === r && m(!1) })); const c = t => { "Escape" === t.key ? (t.preventDefault(), m(!1)) : "Enter" === t.key ? (t.preventDefault(), m(!0)) : "Tab" === t.key && (t.preventDefault(), document.activeElement === l ? d.focus() : l.focus()) }; document.addEventListener("keydown", c, { capture: !0 }); const u = t => { document.removeEventListener("keydown", c, { capture: !0 }), m(t) }; l.addEventListener("click", (() => u(!0))), d.addEventListener("click", (() => u(!1))), r.addEventListener("click", (t => { t.target === r && u(!1) })), d.focus() })) } function buildSidebar() { const e = document.createElement("aside"); e.className = "sidebar", e.innerHTML = ['<div class="sidebar-title">' + t("common.app") + "</div>", '<nav class="nav">', '<a class="nav-item" href="/index.html">' + t("common.nav.home") + "</a>", '<a class="nav-item" href="/uboot.html">' + t("common.nav.uboot") + "</a>", '<div class="nav-section">' + t("common.sections.enhancements") + "</div>", '<a class="nav-item" href="/gpt.html">' + t("common.nav.gpt") + "</a>", '<a class="nav-item" href="/bl2.html">' + t("common.nav.bl2") + "</a>", '<a class="nav-item" href="/initramfs.html">' + t("common.nav.initramfs") + "</a>", "</nav>"].join(""), document.body.appendChild(e), document.body.classList.add("has-sidebar") } function buildHeader() { const t = document.createElement("header"); t.className = "topbar"; const e = document.createElement("div"); e.className = "topbar-controls"; const n = document.createElement("div"); n.className = "control-group"; const o = document.createElement("span"); o.className = "icon", o.textContent = "ğŸŒ"; const a = document.createElement("select"); a.className = "control", a.title = "Language"; const i = localStorage.getItem("lang") || "auto";[{ v: "auto", l: "Auto" }, { v: "zh-CN", l: "ç®€ä½“ä¸­æ–‡" }, { v: "en", l: "English" }].forEach((t => { const e = document.createElement("option"); e.value = t.v, e.textContent = t.l, i === t.v && (e.selected = !0), a.appendChild(e) })), a.addEventListener("change", (() => { localStorage.setItem("lang", a.value), applyPageTranslations(), document.querySelectorAll(".sidebar").forEach((t => t.remove())), buildSidebar() })), n.appendChild(o), n.appendChild(a); const r = document.createElement("div"); r.className = "control-group"; const s = document.createElement("span"); s.className = "icon", s.textContent = "ğŸŒ“"; const l = document.createElement("select"); l.className = "control", l.title = "Theme"; const d = localStorage.getItem("theme") || "auto";[{ v: "auto", l: "Auto" }, { v: "light", l: "Light" }, { v: "dark", l: "Dark" }].forEach((t => { const e = document.createElement("option"); e.value = t.v, e.textContent = t.l, d === t.v && (e.selected = !0), l.appendChild(e) })), l.addEventListener("change", (() => { localStorage.setItem("theme", l.value); applyTheme("auto" === l.value ? detectTheme() : l.value) })), r.appendChild(s), r.appendChild(l), e.appendChild(n), e.appendChild(r), t.appendChild(e), document.body.appendChild(t) } function initSite() { try { buildSidebar(), buildHeader(), applyTheme(detectTheme()), initThemeWatcher(), renderTemplateIfApplicable(), applyPageTranslations(), injectAuthorInfo() } catch (t) { console && console.warn && console.warn("UI init failed:", t) } } function injectAuthorInfo() { const e = document.getElementById("version"); if (!e) return; if (document.getElementById("author-info")) return; const n = document.createElement("div"); n.id = "author-info", n.className = "author-info", n.textContent = t("common.author"), e.insertAdjacentElement("afterend", n) } function startup() { getversion(), document.getElementById("mtd_layout") && getmtdlayoutlist() } function getmtdlayoutlist() { ajax({ url: "/getmtdlayout", done: function (e) { if ("error" != e) { var n = e.split(";"); document.getElementById("current_mtd_layout").innerHTML = t("common.labels.current_mtd_layout") + " " + n[0]; for (var o = document.getElementById("mtd_layout_label"), a = 1; a < n.length; a++)n[a].length > 0 && o.options.add(new Option(n[a], n[a])); if (document.getElementById("mtd_layout").style.display = "", document.getElementById("mtd_layout_label")) { var i = document.getElementById("mtd_layout"); i && i.childNodes.forEach((function (e) { e.nodeType === Node.TEXT_NODE && e.nodeValue.trim().startsWith("Choose") && (e.nodeValue = t("common.labels.choose_mtd_layout") + "\t") })) } } } }) } function getversion() { ajax({ url: "/version", done: function (t) { document.getElementById("version").innerHTML = t } }) } function upload(e) { var n = document.getElementById("file").files[0]; if (n) { document.getElementById("form").style.display = "none", document.getElementById("hint").style.display = "none"; var o = new FormData; o.append(e, n); var a = document.getElementById("mtd_layout_label"); if (a && a.options.length > 0) { var i = a.selectedIndex; o.append("mtd_layout", a.options[i].value) } ajax({ url: "/upload", data: o, done: function (e) { if ("fail" == e) location = "/fail.html"; else { const n = e.split(" "); document.getElementById("size").style.display = "block", document.getElementById("size").innerHTML = t("common.labels.size") + " " + n[0], document.getElementById("md5").style.display = "block", document.getElementById("md5").innerHTML = t("common.labels.md5") + " " + n[1], n[2] && (document.getElementById("mtd").style.display = "block", document.getElementById("mtd").innerHTML = t("common.labels.mtd_layout") + " " + n[2]), document.getElementById("upgrade").style.display = "block" } }, progress: function (t) { var e = parseInt(t.loaded / t.total * 100); document.getElementById("bar").setAttribute("style", "--percent: " + e) } }) } } document.addEventListener("DOMContentLoaded", initSite);