function normalizeLang(n) { if (!n) return null; var t = String(n).toLowerCase(); return t === "zh" || t.indexOf("zh-") === 0 ? "zh" : t === "en" || t.indexOf("en-") === 0 ? "en" : null } function detectLangFromBrowser() { var n, t; try { if (navigator.languages && navigator.languages.length) for (n = 0; n < navigator.languages.length; n++)if (t = normalizeLang(navigator.languages[n]), t) return t; return normalizeLang(navigator.language) || "en" } catch (i) { return "en" } } function getLangFromUrl() { try { if (!location || !location.search) return null; var n = new URLSearchParams(location.search); return normalizeLang(n.get("lang")) } catch (t) { return null } } function t(n) { var t = i18n[currentLang] || i18n.en; return t && t[n] || i18n.en && i18n.en[n] || n } function applyI18n() { for (var r, u, f, n, e, o, s = document.querySelectorAll("[data-i18n]"), i = 0; i < s.length; i++)r = s[i], u = r.getAttribute("data-i18n"), u && (r.innerHTML = t(u)); for (f = document.querySelectorAll("[data-i18n-value]"), n = 0; n < f.length; n++)e = f[n], o = e.getAttribute("data-i18n-value"), o && (e.value = t(o)); currentTitleKey && (document.title = t(currentTitleKey)) } function setLang(n) { currentLang = n; try { localStorage.setItem("lang", n) } catch (t) { } applyI18n() } function setupLangSwitcher() { var n = document.getElementById("lang-select"), i; n && (n.value = currentLang, n.onchange = function () { setLang(n.value) }, i = document.querySelector('label[for="lang-select"][data-i18n="lang_label"]'), i && (i.innerHTML = t("lang_label"))) } function renderUploadPage(n) { var t = { firmware: { titleKey: "title_firmware", hintKey: "hint_firmware", uploadField: "firmware", nextUrl: "/flashing.html", nextKey: "update", confirmKey: "confirm_update", showMtdLayout: !0, warnings: ["warn_power", "warn_restart", "warn_fw_image"] }, bl2: { titleKey: "title_bl2", hintKey: "hint_bl2", uploadField: "bl2", nextUrl: "/flashing.html", nextKey: "update", confirmKey: "confirm_update", showMtdLayout: !1, warnings: ["warn_power", "warn_restart", "warn_bl2_danger"] }, uboot: { titleKey: "title_uboot", hintKey: "hint_uboot", uploadField: "fip", nextUrl: "/flashing.html", nextKey: "update", confirmKey: "confirm_update", showMtdLayout: !1, warnings: ["warn_power", "warn_restart", "warn_uboot_danger"] }, initramfs: { titleKey: "title_initramfs", hintKey: "hint_initramfs", uploadField: "initramfs", nextUrl: "/booting.html", nextKey: "boot", confirmKey: "confirm_boot", showMtdLayout: !1, warnings: ["warn_initramfs_boot", "warn_initramfs_image"] }, gpt: { titleKey: "title_gpt", hintKey: "hint_gpt", uploadField: "gpt", nextUrl: "/flashing.html", nextKey: "update", confirmKey: "confirm_update", showMtdLayout: !1, warnings: ["warn_power", "warn_restart", "warn_gpt_danger"] } }[n], i; t && (currentTitleKey = t.titleKey, document.body.innerHTML = '<div class="layout"><aside class="sidebar"><label for="lang-select" data-i18n="lang_label">Language<\/label><select id="lang-select"><option value="en">English<\/option><option value="zh">ä¸­æ–‡<\/option><\/select><nav class="nav"><a href="/" data-i18n="nav_firmware">Firmware<\/a><a href="/bl2.html" data-i18n="nav_bl2">BL2<\/a><a href="/uboot.html" data-i18n="nav_uboot">U-Boot<\/a><a href="/initramfs.html" data-i18n="nav_initramfs">Initramfs<\/a><a href="/gpt.html" data-i18n="nav_gpt">GPT<\/a><\/nav><\/aside><main class="content"><h1 data-i18n="' + t.titleKey + '"><\/h1><p id="hint" data-i18n="' + t.hintKey + '"><\/p><form id="form">' + (t.showMtdLayout ? '<div id="mtd_layout" style="display: none;"><div id="current_mtd_layout"><\/div><div><span data-i18n="choose_mtd_layout">MTD layout<\/span>:<select id="mtd_layout_label" name="mtd_layout_label"><\/select><\/div><\/div>' : "") + '<input id="file" type="file" name="' + t.uploadField + '"><input type="button" data-i18n-value="upload" value="Upload" onclick="upload(\'' + t.uploadField + '\')"><\/form><div class="bar" id="bar" style="display: none; --percent: 0;"><\/div><div id="size" style="display: none;"><\/div><div id="md5" style="display: none;"><\/div><div id="mtd" style="display: none;"><\/div><div id="upgrade" style="display: none;"><p data-i18n="' + t.confirmKey + '"><\/p><button type="button" id="next-btn" class="button" data-i18n="' + t.nextKey + '">Update<\/button><\/div><div><strong data-i18n="warnings_title">Notes<\/strong><ul>' + t.warnings.map(function (n) { return '<li data-i18n="' + n + '"><\/li>' }).join("") + '<\/ul><\/div><div id="version" class="muted"><\/div><\/main><\/div>', i = document.getElementById("next-btn"), i && (i.onclick = function () { location = t.nextUrl }), getversion(), t.showMtdLayout && getmtdlayoutlist()) } function ajax(n) { var t, i; t = window.XMLHttpRequest ? new XMLHttpRequest : new ActiveXObject("Microsoft.XMLHTTP"); t.upload.addEventListener("progress", function (t) { n.progress && n.progress(t) }); t.onreadystatechange = function () { t.readyState == 4 && t.status == 200 && n.done && n.done(t.responseText) }; n.timeout && (t.timeout = n.timeout); i = "GET"; n.data && (i = "POST"); t.open(i, n.url); t.send(n.data) } function startup() { getversion(); getmtdlayoutlist() } function getmtdlayoutlist() { ajax({ url: "/getmtdlayout", done: function (n) { var i, r; if (n != "error") { var u = document.getElementById("current_mtd_layout"), f = document.getElementById("mtd_layout_label"), e = document.getElementById("mtd_layout"); if (u && f && e) { for (i = n.split(";"), u.innerHTML = t("current_mtd_layout") + ": " + i[0], r = 1; r < i.length; r++)i[r].length > 0 && f.options.add(new Option(i[r], i[r])); e.style.display = "" } } } }) } function getversion() { ajax({ url: "/version", done: function (n) { var i = document.getElementById("version"), r, t; i && (r = " ğŸ’¡Yuzhii", t = n == null ? "" : String(n), t.indexOf("Yuzhii") === -1 && (t += r), i.textContent = t) } }) } function upload(n) { var f = document.getElementById("file").files[0], u, r, i, e; f && (document.getElementById("form").style.display = "none", document.getElementById("hint").style.display = "none", u = document.getElementById("bar"), u && (u.style.display = "block"), r = new FormData, r.append(n, f), i = document.getElementById("mtd_layout_label"), i && i.options.length > 0 && (e = i.selectedIndex, r.append("mtd_layout", i.options[e].value)), ajax({ url: "/upload", data: r, done: function (n) { if (n == "fail") location = "/fail.html"; else { const i = n.split(" "); document.getElementById("size").style.display = "block"; document.getElementById("size").innerHTML = t("size") + ": " + i[0]; document.getElementById("md5").style.display = "block"; document.getElementById("md5").innerHTML = t("md5") + ": " + i[1]; i[2] && (document.getElementById("mtd").style.display = "block", document.getElementById("mtd").innerHTML = t("mtd_layout") + ": " + i[2]); document.getElementById("upgrade").style.display = "block" } }, progress: function (n) { var t = parseInt(n.loaded / n.total * 100); document.getElementById("bar").setAttribute("style", "--percent: " + t) } })) } var currentLang = function () { var n = getLangFromUrl(), t; if (n) { try { localStorage.setItem("lang", n) } catch (i) { } return n } try { if (t = normalizeLang(localStorage.getItem("lang")), t) return t } catch (i) { } return detectLangFromBrowser() }(), currentTitleKey = null, i18n = { en: { lang_label: "Language", nav_firmware: "Firmware", nav_bl2: "BL2 update", nav_uboot: "U-Boot update", nav_initramfs: "Initramfs", nav_gpt: "GPT", title_firmware: "Firmware update", title_bl2: "BL2 update", title_uboot: "U-Boot update", title_initramfs: "Load initramfs", title_gpt: "GPT update", title_update_in_progress: "UPDATE IN PROGRESS", title_update_completed: "UPDATE COMPLETED", title_booting_initramfs: "BOOTING INITRAMFS", title_boot_success: "BOOT SUCCESS", title_update_failed: "UPDATE FAILED", title_page_not_found: "PAGE NOT FOUND", hint_firmware: "Select firmware file and click <strong>Upload<\/strong>.", hint_bl2: "Select <strong>BL2<\/strong> file and click <strong>Upload<\/strong>.", hint_uboot: "Select <strong>U-Boot<\/strong> file and click <strong>Upload<\/strong>.", hint_initramfs: "Select <strong>initramfs<\/strong> and click <strong>Upload<\/strong>.", hint_gpt: "Select <strong>GPT<\/strong> file and click <strong>Upload<\/strong>.", upload: "Upload", update: "Update", boot: "Boot", choose_mtd_layout: "MTD layout", current_mtd_layout: "Current MTD", mtd_layout: "MTD layout", size: "Size", md5: "MD5", confirm_update: 'If OK, click "Update".', confirm_boot: 'If OK, click "Boot".', update_uploading_info: "Uploaded. Updating... please wait.", update_success_info: "Update OK. Rebooting...", boot_uploading_info: "Uploaded. Booting... please wait.", boot_success_info: "Boot OK.", warnings_title: "Notes", warn_power: "Do not power off.", warn_restart: "Device may reboot.", warn_fw_image: "Use correct image.", warn_bl2_danger: "BL2 update is risky!", warn_uboot_danger: "U-Boot update is risky!", warn_gpt_danger: "GPT update is risky!", warn_initramfs_boot: "Boots into initramfs.", warn_initramfs_image: "Use correct initramfs.", fail_message: "Update failed. Check file and try again.", notfound_message: "Page not found." }, zh: { lang_label: "è¯­è¨€", nav_firmware: "å›ºä»¶æ›´æ–°", nav_bl2: "BL2 æ›´æ–°", nav_uboot: "U-Boot æ›´æ–°", nav_initramfs: "initramfs", nav_gpt: "GPT", title_firmware: "å›ºä»¶æ›´æ–°", title_bl2: "BL2 æ›´æ–°", title_uboot: "U-Boot æ›´æ–°", title_initramfs: "åŠ è½½ initramfs", title_gpt: "GPT æ›´æ–°", title_update_in_progress: "æ­£åœ¨æ›´æ–°", title_update_completed: "æ›´æ–°å®Œæˆ", title_booting_initramfs: "æ­£åœ¨å¼•å¯¼ initramfs", title_boot_success: "å¼•å¯¼æˆåŠŸ", title_update_failed: "æ›´æ–°å¤±è´¥", title_page_not_found: "é¡µé¢æœªæ‰¾åˆ°", hint_firmware: "é€‰æ‹©å›ºä»¶æ–‡ä»¶å¹¶ç‚¹å‡»<strong>ä¸Šä¼ <\/strong>ã€‚", hint_bl2: "é€‰æ‹© <strong>BL2<\/strong> æ–‡ä»¶å¹¶ç‚¹å‡»<strong>ä¸Šä¼ <\/strong>ã€‚", hint_uboot: "é€‰æ‹© <strong>U-Boot<\/strong> æ–‡ä»¶å¹¶ç‚¹å‡»<strong>ä¸Šä¼ <\/strong>ã€‚", hint_initramfs: "é€‰æ‹© <strong>initramfs<\/strong> å¹¶ç‚¹å‡»<strong>ä¸Šä¼ <\/strong>ã€‚", hint_gpt: "é€‰æ‹© <strong>GPT<\/strong> æ–‡ä»¶å¹¶ç‚¹å‡»<strong>ä¸Šä¼ <\/strong>ã€‚", upload: "ä¸Šä¼ ", update: "æ›´æ–°", boot: "å¼•å¯¼", choose_mtd_layout: "MTD å¸ƒå±€", current_mtd_layout: "å½“å‰ MTD", mtd_layout: "MTD å¸ƒå±€", size: "å¤§å°", md5: "MD5", confirm_update: "ç¡®è®¤æ— è¯¯åç‚¹å‡»â€œæ›´æ–°â€ã€‚", confirm_boot: "ç¡®è®¤æ— è¯¯åç‚¹å‡»â€œå¼•å¯¼â€ã€‚", update_uploading_info: "å·²ä¸Šä¼ ï¼Œæ­£åœ¨æ›´æ–°â€¦", update_success_info: "æ›´æ–°æˆåŠŸï¼Œæ­£åœ¨é‡å¯â€¦", boot_uploading_info: "å·²ä¸Šä¼ ï¼Œæ­£åœ¨å¼•å¯¼â€¦", boot_success_info: "å¼•å¯¼æˆåŠŸã€‚", warnings_title: "æç¤º", warn_power: "æ›´æ–°æœŸé—´å‹¿æ–­ç”µã€‚", warn_restart: "è®¾å¤‡å¯èƒ½ä¼šé‡å¯ã€‚", warn_fw_image: "è¯·ä½¿ç”¨æ­£ç¡®é•œåƒã€‚", warn_bl2_danger: "BL2 æ›´æ–°é£é™©é«˜ï¼", warn_uboot_danger: "U-Boot æ›´æ–°é£é™©é«˜ï¼", warn_gpt_danger: "GPT æ›´æ–°æœ‰é£é™©ï¼", warn_initramfs_boot: "å°†å¼•å¯¼è‡³ initramfsã€‚", warn_initramfs_image: "è¯·ä½¿ç”¨æ­£ç¡® initramfsã€‚", fail_message: "æ›´æ–°å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶åé‡è¯•ã€‚", notfound_message: "é¡µé¢ä¸å­˜åœ¨ã€‚" } }; document.addEventListener("DOMContentLoaded", function () { var n = document.body && document.body.getAttribute("data-page"); n && renderUploadPage(n); setupLangSwitcher(); applyI18n() })